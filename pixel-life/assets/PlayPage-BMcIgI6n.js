import{j as e,u as I,r as u}from"./index-OPFde3V9.js";import{u as i,f as L,d as M,e as R,S as $,c as D}from"./game-store-Do9y9pZe.js";import{s as P}from"./history-db-Bpxs1fj9.js";import{S as G}from"./StatPanel-C1_lpaWF.js";import{P as b}from"./PixelCard-DXqAhZFG.js";const _={infant:"ðŸ‘¶",student:"ðŸ“š",adult:"ðŸ’¼",senior:"ðŸ¡"},q={infant:"ìœ ì•„ê¸°",student:"í•™ìƒê¸°",adult:"ì„±ì¸ê¸°",senior:"ë…¸ë…„ê¸°"},B={infant:{min:0,max:5},student:{min:6,max:18},adult:{min:19,max:59},senior:{min:60,max:80}};function Y({stage:a,age:s}){const x=_[a],d=q[a],c=B[a],o=c.max-c.min,h=Math.max(0,s-c.min),r=o>0?Math.min(100,Math.round(h/o*100)):0;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-lg shrink-0",children:x}),e.jsx("span",{className:"text-sm shrink-0",style:{color:"var(--color-text-white)"},children:d}),e.jsxs("span",{className:"text-sm shrink-0",style:{color:"var(--color-stat-luck)"},children:[s,"ì„¸"]}),e.jsx("div",{className:"flex-1 h-3 bg-[var(--color-bg-secondary)] relative overflow-hidden",style:{boxShadow:`
            2px 0 0 0 var(--color-border),
            -2px 0 0 0 var(--color-border),
            0 2px 0 0 var(--color-border),
            0 -2px 0 0 var(--color-border)
          `},children:e.jsx("div",{className:"h-full transition-all duration-300",style:{width:`${r}%`,backgroundColor:"var(--color-accent)"}})}),e.jsxs("span",{className:"text-xs text-[var(--color-text-dim)] shrink-0 w-10 text-right",children:[r,"%"]})]})}function J(a){return String.fromCharCode(65+a)}function K({text:a,index:s,onClick:x,disabled:d}){const c=J(s);return e.jsxs("button",{type:"button",onClick:x,disabled:d,className:`
        w-full text-left px-4 py-3 mb-2
        transition-colors duration-100
        border-0 cursor-pointer
        ${d?"opacity-50 cursor-not-allowed bg-[var(--color-bg-secondary)] text-[var(--color-text-dim)]":"bg-[var(--color-bg-card)] text-[var(--color-text-primary)] hover:bg-[var(--color-bg-hover)] hover:text-[var(--color-text-white)]"}
      `,style:{boxShadow:d?`2px 0 0 0 var(--color-border),
             -2px 0 0 0 var(--color-border),
             0 2px 0 0 var(--color-border),
             0 -2px 0 0 var(--color-border)`:`2px 0 0 0 var(--color-text-dim),
             -2px 0 0 0 var(--color-text-dim),
             0 2px 0 0 var(--color-text-dim),
             0 -2px 0 0 var(--color-text-dim)`},onMouseEnter:o=>{d||(o.currentTarget.style.boxShadow=`
            2px 0 0 0 var(--color-border-bright),
            -2px 0 0 0 var(--color-border-bright),
            0 2px 0 0 var(--color-border-bright),
            0 -2px 0 0 var(--color-border-bright)
          `)},onMouseLeave:o=>{d||(o.currentTarget.style.boxShadow=`
            2px 0 0 0 var(--color-text-dim),
            -2px 0 0 0 var(--color-text-dim),
            0 2px 0 0 var(--color-text-dim),
            0 -2px 0 0 var(--color-text-dim)
          `)},children:[e.jsxs("span",{className:"text-[var(--color-stat-luck)] mr-2 font-bold",children:[c,"."]}),e.jsx("span",{children:a})]})}function O({event:a,onChoice:s,disabled:x}){return e.jsxs(b,{title:a.title,children:[e.jsx("p",{className:"text-[var(--color-text-white)] mb-4 leading-relaxed",children:a.description}),e.jsx("div",{className:"flex flex-col gap-1",children:a.choices.map((d,c)=>e.jsx(K,{text:d.text,index:c,onClick:()=>s(c),disabled:x},`${a.id}-choice-${c}`))})]})}function Q(){const a=I(),s=i(t=>t.character),x=i(t=>t.currentAge),d=i(t=>t.currentStage),c=i(t=>t.stats),o=i(t=>t.isAlive),h=i(t=>t.currentEvent),r=i(t=>t.lastTurnResult),p=i(t=>t.loadedEvents),w=i(t=>t.prngState),g=i(t=>t.acquiredTags),j=i(t=>t.history),S=i(t=>t.phase),E=i(t=>t.advanceTurn),[C,T]=u.useState(!1);u.useEffect(()=>{s===null&&a("/")},[s,a]),u.useEffect(()=>{if(h===null&&r===null&&o&&p.length>0&&S==="playing"){const t=D(w),n=L(p,x,d,c,g),v=n.length>0?n:p.filter(l=>l.stage===d);if(v.length>0){const l=M(v,t);i.setState({currentEvent:l})}}},[h,r,o,p,S,w,x,d,c,g]),u.useEffect(()=>{if(!o&&s!==null&&!C){T(!0);const t=R(j,c,x,g,s.initialStats);P({id:`${s.seed}-${Date.now()}`,character:s,finalAge:x,finalStats:{...c},history:[...j],achievements:t,createdAt:Date.now()})}},[o,s,C,j,c,x,g]);const f=u.useCallback(t=>{E(t)},[E]),N=u.useCallback(()=>{i.setState({lastTurnResult:null,currentEvent:null})},[]),y=u.useCallback(()=>{if(h===null)return;const t=Math.floor(Math.random()*h.choices.length);f(t)},[h,f]);if(u.useEffect(()=>{function t(n){const v=n.target;if(v.tagName==="INPUT"||v.tagName==="TEXTAREA"||v.tagName==="SELECT")return;const l=n.key.toLowerCase();if(!o){(l===" "||l==="enter")&&(n.preventDefault(),a("/report"));return}if(r!==null){(l===" "||l==="enter")&&(n.preventDefault(),N());return}if(h!==null){if(l===" "||l==="enter"){n.preventDefault(),y();return}const A=h.choices.length;let m=-1;l==="1"||l==="a"?m=0:l==="2"||l==="b"?m=1:(l==="3"||l==="c")&&(m=2),m>=0&&m<A&&(n.preventDefault(),f(m))}}return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}},[o,r,h,a,N,f,y]),s===null)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px] text-[var(--color-text-dim)]",children:"ë¡œë”© ì¤‘..."});const k=r!==null?r.statChanges.reduce((t,n)=>(t[n.stat]=(t[n.stat]??0)+n.delta,t),{}):void 0;return e.jsxs("div",{className:"flex flex-col gap-4 py-4",children:[e.jsx(Y,{stage:d,age:x}),x===0&&r===null&&o&&e.jsx("div",{className:"text-xs text-[var(--color-text-dim)] text-center py-1 opacity-70",children:"í‚¤ë³´ë“œ: Space ë¹ ë¥¸ ì§„í–‰ | 1Â·2Â·3 ì„ íƒì§€ ì§ì ‘ ì„ íƒ"}),e.jsx(b,{title:`${s.name}ì˜ ëŠ¥ë ¥ì¹˜`,children:e.jsx(G,{stats:c,deltas:k})}),!o&&e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(b,{title:"ì¸ìƒì˜ ë",children:e.jsxs("div",{className:"text-center py-4",children:[e.jsxs("p",{className:"text-[var(--color-text-white)] text-lg mb-2",children:[s.name,"ì˜ ì¸ìƒì´ ëë‚¬ìŠµë‹ˆë‹¤."]}),e.jsxs("p",{className:"text-[var(--color-stat-luck)] text-sm mb-4",children:["í–¥ë…„ ",x,"ì„¸"]}),r!==null&&e.jsxs("div",{className:"text-left mb-4",children:[e.jsxs("p",{className:"text-[var(--color-text-dim)] text-sm mb-2",children:["ë§ˆì§€ë§‰ ì´ë²¤íŠ¸: ",r.event.title]}),e.jsx("p",{className:"text-[var(--color-text-white)] text-sm",children:r.succeeded===!1?r.event.choices[r.choiceIndex]?.successCheck?.failText??r.event.choices[r.choiceIndex]?.resultText:r.event.choices[r.choiceIndex]?.resultText})]})]})}),e.jsxs("button",{type:"button",className:"w-full px-6 py-4 text-center text-lg bg-[var(--color-bg-card)] text-[var(--color-accent)] hover:bg-[var(--color-bg-hover)] hover:text-[var(--color-text-white)] transition-colors duration-100 border-0 cursor-pointer",style:{boxShadow:`
                2px 0 0 0 var(--color-accent-dim),
                -2px 0 0 0 var(--color-accent-dim),
                0 2px 0 0 var(--color-accent-dim),
                0 -2px 0 0 var(--color-accent-dim)
              `},onClick:()=>a("/report"),children:[e.jsx("span",{className:"mr-2",children:"â–¶"}),"ì¸ìƒ ë¦¬í¬íŠ¸ ë³´ê¸°"]})]}),o&&h===null&&r===null&&p.length===0&&e.jsxs(b,{children:[e.jsx("p",{className:"text-[var(--color-text-dim)] text-center py-4",children:"ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ìºë¦­í„° ìƒì„± íŽ˜ì´ì§€ì—ì„œ ë‹¤ì‹œ ì‹œìž‘í•´ì£¼ì„¸ìš”."}),e.jsx("button",{type:"button",className:"w-full px-4 py-2 text-center text-sm bg-[var(--color-bg-secondary)] text-[var(--color-text-primary)] hover:bg-[var(--color-bg-hover)] transition-colors duration-100 border-0 cursor-pointer",onClick:()=>a("/create"),children:"ìºë¦­í„° ìƒì„±ìœ¼ë¡œ ëŒì•„ê°€ê¸°"})]}),o&&h!==null&&r===null&&e.jsxs("button",{type:"button",className:"w-full px-6 py-3 text-center bg-[var(--color-bg-card)] text-[var(--color-stat-luck)] hover:bg-[var(--color-bg-hover)] hover:text-[var(--color-text-white)] transition-colors duration-100 border-0 cursor-pointer",style:{boxShadow:`
              2px 0 0 0 var(--color-border),
              -2px 0 0 0 var(--color-border),
              0 2px 0 0 var(--color-border),
              0 -2px 0 0 var(--color-border)
            `},onClick:y,children:[e.jsx("span",{className:"mr-2",children:"ðŸŽ²"}),"ëžœë¤ ì„ íƒ",e.jsx("span",{className:"text-[var(--color-text-dim)] text-xs ml-2",children:"[Space]"})]}),o&&r!==null&&e.jsxs("button",{type:"button",className:"w-full px-6 py-3 text-center bg-[var(--color-bg-card)] text-[var(--color-text-primary)] hover:bg-[var(--color-bg-hover)] hover:text-[var(--color-text-white)] transition-colors duration-100 border-0 cursor-pointer",style:{boxShadow:`
              2px 0 0 0 var(--color-border),
              -2px 0 0 0 var(--color-border),
              0 2px 0 0 var(--color-border),
              0 -2px 0 0 var(--color-border)
            `},onClick:N,children:[e.jsx("span",{className:"mr-2",children:"â–¶"}),"ë‹¤ìŒ í•´ë¡œ",e.jsx("span",{className:"text-[var(--color-text-dim)] text-xs ml-2",children:"[Space]"})]}),o&&r!==null&&e.jsxs(b,{title:r.event.title,children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("span",{className:"text-[var(--color-accent)] text-xs mr-1",children:"âœ“"}),e.jsx("span",{className:"text-[var(--color-text-dim)] text-sm",children:r.event.choices[r.choiceIndex]?.text})]}),e.jsx("p",{className:"text-[var(--color-text-white)] mb-3 leading-relaxed",children:r.succeeded===!1?r.event.choices[r.choiceIndex]?.successCheck?.failText??r.event.choices[r.choiceIndex]?.resultText:r.event.choices[r.choiceIndex]?.resultText}),r.succeeded!==null&&e.jsx("p",{className:"text-sm mb-3",style:{color:r.succeeded?"#44cc44":"#ff4444"},children:r.succeeded?"[ ì„±ê³µ ]":"[ ì‹¤íŒ¨ ]"}),r.statChanges.length>0&&e.jsx("div",{className:"flex flex-wrap gap-3 mt-2",children:r.statChanges.map((t,n)=>e.jsxs("span",{className:"text-sm",style:{color:t.delta>0?"#44cc44":"#ff4444"},children:[$[t.stat]," ",t.delta>0?`+${t.delta}`:t.delta,t.delta>0?" â–²":" â–¼"]},`stat-change-${n}`))})]}),o&&h!==null&&r===null&&e.jsx(O,{event:h,onChoice:f,disabled:!1})]})}export{Q as default};
