import{j as t,u as A,r as u}from"./index-DA_so43f.js";import{u as l,f as I,d as L,e as $,S as R,c as D}from"./game-store-BXqJePOw.js";import{s as M}from"./history-db-Bpxs1fj9.js";import{S as P}from"./StatPanel-DGoQl58m.js";import{P as f}from"./PixelCard-CWNn433b.js";const G={infant:"üë∂",student:"üìö",adult:"üíº",senior:"üè°"},_={infant:"Ïú†ÏïÑÍ∏∞",student:"ÌïôÏÉùÍ∏∞",adult:"ÏÑ±Ïù∏Í∏∞",senior:"ÎÖ∏ÎÖÑÍ∏∞"},q={infant:{min:0,max:5},student:{min:6,max:18},adult:{min:19,max:59},senior:{min:60,max:80}};function B({stage:o,age:s}){const d=G[o],n=_[o],c=q[o],a=c.max-c.min,h=Math.max(0,s-c.min),r=a>0?Math.min(100,Math.round(h/a*100)):0;return t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("span",{className:"text-lg shrink-0",children:d}),t.jsx("span",{className:"text-sm shrink-0",style:{color:"var(--color-text-white)"},children:n}),t.jsxs("span",{className:"text-sm shrink-0",style:{color:"var(--color-stat-luck)"},children:[s,"ÏÑ∏"]}),t.jsx("div",{className:"flex-1 h-3 bg-[var(--color-bg-secondary)] relative overflow-hidden",style:{boxShadow:`
            2px 0 0 0 var(--color-border),
            -2px 0 0 0 var(--color-border),
            0 2px 0 0 var(--color-border),
            0 -2px 0 0 var(--color-border)
          `},children:t.jsx("div",{className:"h-full transition-all duration-300",style:{width:`${r}%`,backgroundColor:"var(--color-accent)"}})}),t.jsxs("span",{className:"text-xs text-[var(--color-text-dim)] shrink-0 w-10 text-right",children:[r,"%"]})]})}function Y(o){return String.fromCharCode(65+o)}function J({text:o,index:s,onClick:d,disabled:n}){const c=Y(s);return t.jsxs("button",{type:"button",onClick:d,disabled:n,className:`
        w-full text-left px-4 py-3 mb-2
        transition-colors duration-100
        border-0 cursor-pointer
        ${n?"opacity-50 cursor-not-allowed bg-[var(--color-bg-secondary)] text-[var(--color-text-dim)]":"bg-[var(--color-bg-card)] text-[var(--color-text-primary)] hover:bg-[var(--color-bg-hover)] hover:text-[var(--color-text-white)]"}
      `,style:{boxShadow:n?`2px 0 0 0 var(--color-border),
             -2px 0 0 0 var(--color-border),
             0 2px 0 0 var(--color-border),
             0 -2px 0 0 var(--color-border)`:`2px 0 0 0 var(--color-text-dim),
             -2px 0 0 0 var(--color-text-dim),
             0 2px 0 0 var(--color-text-dim),
             0 -2px 0 0 var(--color-text-dim)`},onMouseEnter:a=>{n||(a.currentTarget.style.boxShadow=`
            2px 0 0 0 var(--color-border-bright),
            -2px 0 0 0 var(--color-border-bright),
            0 2px 0 0 var(--color-border-bright),
            0 -2px 0 0 var(--color-border-bright)
          `)},onMouseLeave:a=>{n||(a.currentTarget.style.boxShadow=`
            2px 0 0 0 var(--color-text-dim),
            -2px 0 0 0 var(--color-text-dim),
            0 2px 0 0 var(--color-text-dim),
            0 -2px 0 0 var(--color-text-dim)
          `)},children:[t.jsxs("span",{className:"text-[var(--color-stat-luck)] mr-2 font-bold",children:[c,"."]}),t.jsx("span",{children:o})]})}function K({event:o,onChoice:s,disabled:d}){return t.jsxs(f,{title:o.title,children:[t.jsx("p",{className:"text-[var(--color-text-white)] mb-4 leading-relaxed",children:o.description}),t.jsx("div",{className:"flex flex-col gap-1",children:o.choices.map((n,c)=>t.jsx(J,{text:n.text,index:c,onClick:()=>s(c),disabled:d},`${o.id}-choice-${c}`))})]})}function H(){const o=A(),s=l(e=>e.character),d=l(e=>e.currentAge),n=l(e=>e.currentStage),c=l(e=>e.stats),a=l(e=>e.isAlive),h=l(e=>e.currentEvent),r=l(e=>e.lastTurnResult),p=l(e=>e.loadedEvents),y=l(e=>e.prngState),b=l(e=>e.acquiredTags),g=l(e=>e.history),w=l(e=>e.phase),E=l(e=>e.advanceTurn),[S,T]=u.useState(!1);u.useEffect(()=>{s===null&&o("/")},[s,o]),u.useEffect(()=>{if(h===null&&r===null&&a&&p.length>0&&w==="playing"){const e=D(y),i=I(p,d,n,c,b),v=i.length>0?i:p.filter(x=>x.stage===n);if(v.length>0){const x=L(v,e);l.setState({currentEvent:x})}}},[h,r,a,p,w,y,d,n,c,b]),u.useEffect(()=>{if(!a&&s!==null&&!S){T(!0);const e=$(g,c,d,b,s.initialStats);M({id:`${s.seed}-${Date.now()}`,character:s,finalAge:d,finalStats:{...c},history:[...g],achievements:e,createdAt:Date.now()})}},[a,s,S,g,c,d,b]);const j=u.useCallback(e=>{E(e)},[E]),N=u.useCallback(()=>{l.setState({lastTurnResult:null,currentEvent:null})},[]);if(u.useEffect(()=>{function e(i){const v=i.target;if(v.tagName==="INPUT"||v.tagName==="TEXTAREA"||v.tagName==="SELECT")return;const x=i.key.toLowerCase();if(!a){(x===" "||x==="enter")&&(i.preventDefault(),o("/report"));return}if(r!==null){(x===" "||x==="enter")&&(i.preventDefault(),N());return}if(h!==null){const k=h.choices.length;let m=-1;x==="1"||x==="a"?m=0:x==="2"||x==="b"?m=1:(x==="3"||x==="c")&&(m=2),m>=0&&m<k&&(i.preventDefault(),j(m))}}return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[a,r,h,o,N,j]),s===null)return t.jsx("div",{className:"flex items-center justify-center min-h-[400px] text-[var(--color-text-dim)]",children:"Î°úÎî© Ï§ë..."});const C=r!==null?r.statChanges.reduce((e,i)=>(e[i.stat]=(e[i.stat]??0)+i.delta,e),{}):void 0;return t.jsxs("div",{className:"flex flex-col gap-4 py-4",children:[t.jsx(B,{stage:n,age:d}),t.jsx(f,{title:`${s.name}Ïùò Îä•Î†•Ïπò`,children:t.jsx(P,{stats:c,deltas:C})}),!a&&t.jsxs("div",{className:"flex flex-col gap-4",children:[t.jsx(f,{title:"Ïù∏ÏÉùÏùò ÎÅù",children:t.jsxs("div",{className:"text-center py-4",children:[t.jsxs("p",{className:"text-[var(--color-text-white)] text-lg mb-2",children:[s.name,"Ïùò Ïù∏ÏÉùÏù¥ ÎÅùÎÇ¨ÏäµÎãàÎã§."]}),t.jsxs("p",{className:"text-[var(--color-stat-luck)] text-sm mb-4",children:["Ìñ•ÎÖÑ ",d,"ÏÑ∏"]}),r!==null&&t.jsxs("div",{className:"text-left mb-4",children:[t.jsxs("p",{className:"text-[var(--color-text-dim)] text-sm mb-2",children:["ÎßàÏßÄÎßâ Ïù¥Î≤§Ìä∏: ",r.event.title]}),t.jsx("p",{className:"text-[var(--color-text-white)] text-sm",children:r.succeeded===!1?r.event.choices[r.choiceIndex]?.successCheck?.failText??r.event.choices[r.choiceIndex]?.resultText:r.event.choices[r.choiceIndex]?.resultText})]})]})}),t.jsxs("button",{type:"button",className:"w-full px-6 py-4 text-center text-lg bg-[var(--color-bg-card)] text-[var(--color-accent)] hover:bg-[var(--color-bg-hover)] hover:text-[var(--color-text-white)] transition-colors duration-100 border-0 cursor-pointer",style:{boxShadow:`
                2px 0 0 0 var(--color-accent-dim),
                -2px 0 0 0 var(--color-accent-dim),
                0 2px 0 0 var(--color-accent-dim),
                0 -2px 0 0 var(--color-accent-dim)
              `},onClick:()=>o("/report"),children:[t.jsx("span",{className:"mr-2",children:"‚ñ∂"}),"Ïù∏ÏÉù Î¶¨Ìè¨Ìä∏ Î≥¥Í∏∞"]})]}),a&&h===null&&r===null&&p.length===0&&t.jsxs(f,{children:[t.jsx("p",{className:"text-[var(--color-text-dim)] text-center py-4",children:"Ïù¥Î≤§Ìä∏ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§. Ï∫êÎ¶≠ÌÑ∞ ÏÉùÏÑ± ÌéòÏù¥ÏßÄÏóêÏÑú Îã§Ïãú ÏãúÏûëÌï¥Ï£ºÏÑ∏Ïöî."}),t.jsx("button",{type:"button",className:"w-full px-4 py-2 text-center text-sm bg-[var(--color-bg-secondary)] text-[var(--color-text-primary)] hover:bg-[var(--color-bg-hover)] transition-colors duration-100 border-0 cursor-pointer",onClick:()=>o("/create"),children:"Ï∫êÎ¶≠ÌÑ∞ ÏÉùÏÑ±ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞"})]}),a&&r!==null&&t.jsxs("div",{className:"flex flex-col gap-4",children:[t.jsxs(f,{title:r.event.title,children:[t.jsxs("div",{className:"mb-3",children:[t.jsx("span",{className:"text-[var(--color-accent)] text-xs mr-1",children:"‚úì"}),t.jsx("span",{className:"text-[var(--color-text-dim)] text-sm",children:r.event.choices[r.choiceIndex]?.text})]}),t.jsx("p",{className:"text-[var(--color-text-white)] mb-3 leading-relaxed",children:r.succeeded===!1?r.event.choices[r.choiceIndex]?.successCheck?.failText??r.event.choices[r.choiceIndex]?.resultText:r.event.choices[r.choiceIndex]?.resultText}),r.succeeded!==null&&t.jsx("p",{className:"text-sm mb-3",style:{color:r.succeeded?"#44cc44":"#ff4444"},children:r.succeeded?"[ ÏÑ±Í≥µ ]":"[ Ïã§Ìå® ]"}),r.statChanges.length>0&&t.jsx("div",{className:"flex flex-wrap gap-3 mt-2",children:r.statChanges.map((e,i)=>t.jsxs("span",{className:"text-sm",style:{color:e.delta>0?"#44cc44":"#ff4444"},children:[R[e.stat]," ",e.delta>0?`+${e.delta}`:e.delta,e.delta>0?" ‚ñ≤":" ‚ñº"]},`stat-change-${i}`))})]}),t.jsxs("button",{type:"button",className:"w-full px-6 py-3 text-center bg-[var(--color-bg-card)] text-[var(--color-text-primary)] hover:bg-[var(--color-bg-hover)] hover:text-[var(--color-text-white)] transition-colors duration-100 border-0 cursor-pointer",style:{boxShadow:`
                2px 0 0 0 var(--color-border),
                -2px 0 0 0 var(--color-border),
                0 2px 0 0 var(--color-border),
                0 -2px 0 0 var(--color-border)
              `},onClick:N,children:[t.jsx("span",{className:"mr-2",children:"‚ñ∂"}),"Îã§Ïùå Ìï¥Î°ú"]})]}),a&&h!==null&&r===null&&t.jsx(K,{event:h,onChoice:j,disabled:!1})]})}export{H as default};
