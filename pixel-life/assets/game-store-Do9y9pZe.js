import{R as T}from"./index-OPFde3V9.js";const k=t=>{let r;const n=new Set,e=(i,u)=>{const g=typeof i=="function"?i(r):i;if(!Object.is(g,r)){const y=r;r=u??(typeof g!="object"||g===null)?g:Object.assign({},r,g),n.forEach(v=>v(r,y))}},a=()=>r,l={setState:e,getState:a,getInitialState:()=>d,subscribe:i=>(n.add(i),()=>n.delete(i))},d=r=t(e,a,l);return l},q=(t=>t?k(t):k),N=t=>t;function G(t,r=N){const n=T.useSyncExternalStore(t.subscribe,T.useCallback(()=>r(t.getState()),[t,r]),T.useCallback(()=>r(t.getInitialState()),[t,r]));return T.useDebugValue(n),n}const C=t=>{const r=q(t),n=e=>G(r,e);return Object.assign(n,r),n},L=(t=>t?C(t):C);function O(t,r){let n;try{n=t()}catch{return}return{getItem:a=>{var s;const c=d=>d===null?null:JSON.parse(d,void 0),l=(s=n.getItem(a))!=null?s:null;return l instanceof Promise?l.then(c):c(l)},setItem:(a,s)=>n.setItem(a,JSON.stringify(s,void 0)),removeItem:a=>n.removeItem(a)}}const b=t=>r=>{try{const n=t(r);return n instanceof Promise?n:{then(e){return b(e)(n)},catch(e){return this}}}catch(n){return{then(e){return this},catch(e){return b(e)(n)}}}},j=(t,r)=>(n,e,a)=>{let s={storage:O(()=>window.localStorage),partialize:o=>o,version:0,merge:(o,p)=>({...p,...o}),...r},c=!1,l=0;const d=new Set,i=new Set;let u=s.storage;if(!u)return t((...o)=>{console.warn(`[zustand persist middleware] Unable to update item '${s.name}', the given storage is currently unavailable.`),n(...o)},e,a);const g=()=>{const o=s.partialize({...e()});return u.setItem(s.name,{state:o,version:s.version})},y=a.setState;a.setState=(o,p)=>(y(o,p),g());const v=t((...o)=>(n(...o),g()),e,a);a.getInitialState=()=>v;let h;const S=()=>{var o,p;if(!u)return;const w=++l;c=!1,d.forEach(f=>{var m;return f((m=e())!=null?m:v)});const _=((p=s.onRehydrateStorage)==null?void 0:p.call(s,(o=e())!=null?o:v))||void 0;return b(u.getItem.bind(u))(s.name).then(f=>{if(f)if(typeof f.version=="number"&&f.version!==s.version){if(s.migrate){const m=s.migrate(f.state,f.version);return m instanceof Promise?m.then(E=>[!0,E]):[!0,m]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,f.state];return[!1,void 0]}).then(f=>{var m;if(w!==l)return;const[E,H]=f;if(h=s.merge(H,(m=e())!=null?m:v),n(h,!0),E)return g()}).then(()=>{w===l&&(_?.(h,void 0),h=e(),c=!0,i.forEach(f=>f(h)))}).catch(f=>{w===l&&_?.(void 0,f)})};return a.persist={setOptions:o=>{s={...s,...o},o.storage&&(u=o.storage)},clearStorage:()=>{u?.removeItem(s.name)},getOptions:()=>s,rehydrate:()=>S(),hasHydrated:()=>c,onHydrate:o=>(d.add(o),()=>{d.delete(o)}),onFinishHydration:o=>(i.add(o),()=>{i.delete(o)})},s.skipHydration||S(),h||v},F=j;function D(t){let r=t|0;function n(){r=r+1831565813|0;let i=Math.imul(r^r>>>15,1|r);return i=i+Math.imul(i^i>>>7,61|i)^i,((i^i>>>14)>>>0)/4294967296}function e(){return n()}function a(){return n()}function s(i,u){if(i===u)return i;const g=u-i+1;return i+Math.floor(n()*g)}function c(i){if(i.length===0)throw new Error("pick: ë¹ˆ ë°°ì—´ì—ì„œ ì„ íƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤");return i[Math.floor(n()*i.length)]}function l(i,u){if(i.length===0)throw new Error("weightedPick: ë¹ˆ ë°°ì—´ì—ì„œ ì„ íƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤");if(i.length!==u.length)throw new Error("weightedPick: itemsì™€ weightsì˜ ê¸¸ì´ê°€ ë‹¤ë¦…ë‹ˆë‹¤");const g=u.reduce((h,S)=>h+S,0);if(g<=0)return i[Math.floor(n()*i.length)];const y=n()*g;let v=0;for(let h=0;h<i.length;h++)if(v+=u[h],y<v)return i[h];return i[i.length-1]}function d(){return r}return{next:e,nextInt:s,nextFloat:a,pick:c,weightedPick:l,state:d}}const B=0,J=100,ct={intelligence:"ì§€ëŠ¥",strength:"ì²´ë ¥",charm:"ë§¤ë ¥",luck:"ìš´",wealth:"ì¬ì‚°"},U=["intelligence","strength","charm","luck","wealth"];function A(t){return Math.max(B,Math.min(J,t))}function X(t,r){const n={intelligence:t.nextInt(20,80),strength:t.nextInt(20,80),charm:t.nextInt(20,80),luck:t.nextInt(20,80),wealth:t.nextInt(20,80)};for(const e of U){const a=r.statModifiers[e];a!==void 0&&(n[e]=A(n[e]+a))}return n}function V(t,r){const n={...t};for(const e of r)n[e.stat]=A(n[e.stat]+e.delta);return n}function W(t,r,n){switch(t.type){case"stat_min":return t.stat===void 0||t.value===void 0?!0:r[t.stat]>=t.value;case"stat_max":return t.stat===void 0||t.value===void 0?!0:r[t.stat]<=t.value;case"has_tag":return t.tag===void 0?!0:n.includes(t.tag);case"not_has_tag":return t.tag===void 0?!0:!n.includes(t.tag);default:return!0}}function $(t,r,n,e,a){return t.filter(s=>{if(s.stage!==n||r<s.minAge||r>s.maxAge)return!1;for(const c of s.conditions)if(!W(c,e,a))return!1;return!0})}function K(t,r){if(t.length===0)throw new Error("selectEvent: ì„ íƒ ê°€ëŠ¥í•œ ì´ë²¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤");const n=t.map(e=>e.weight);return r.weightedPick(t,n)}function Q(t,r,n){if(t.successCheck===null||t.successCheck===void 0)return{succeeded:null,statChanges:t.results,resultText:t.resultText,tags:t.tags};const e=t.successCheck;return r[e.stat]>=e.threshold?{succeeded:!0,statChanges:t.results,resultText:t.resultText,tags:t.tags}:{succeeded:!1,statChanges:e.failResults,resultText:e.failText,tags:[]}}const Y=[{id:"genius",title:"ì²œì¬",description:"ì§€ëŠ¥ 90 ì´ìƒìœ¼ë¡œ ì¸ìƒì„ ë§ˆê°",condition:{type:"stat_final_min",stat:"intelligence",value:90},icon:"ğŸ§ "},{id:"athlete",title:"ê°•ì¸í•œ ì²´ë ¥",description:"ì²´ë ¥ 90 ì´ìƒìœ¼ë¡œ ì¸ìƒì„ ë§ˆê°",condition:{type:"stat_final_min",stat:"strength",value:90},icon:"ğŸ’ª"},{id:"charmer",title:"ë§¤ë ¥ì™•",description:"ë§¤ë ¥ 90 ì´ìƒìœ¼ë¡œ ì¸ìƒì„ ë§ˆê°",condition:{type:"stat_final_min",stat:"charm",value:90},icon:"âœ¨"},{id:"lucky",title:"í–‰ìš´ì•„",description:"ìš´ 90 ì´ìƒìœ¼ë¡œ ì¸ìƒì„ ë§ˆê°",condition:{type:"stat_final_min",stat:"luck",value:90},icon:"ğŸ€"},{id:"rich",title:"ë¶€ì",description:"ì¬ì‚° 90 ì´ìƒìœ¼ë¡œ ì¸ìƒì„ ë§ˆê°",condition:{type:"stat_final_min",stat:"wealth",value:90},icon:"ğŸ’°"},{id:"long_life",title:"ì¥ìˆ˜",description:"80ì„¸ ì´ìƒê¹Œì§€ ìƒì¡´",condition:{type:"age_min",value:80},icon:"ğŸ‚"},{id:"early_death",title:"ìš”ì ˆ",description:"30ì„¸ ë¯¸ë§Œì— ì‚¬ë§",condition:{type:"age_max",value:29},icon:"ğŸ’€"},{id:"balanced",title:"ê· í˜• ì¡íŒ ì¸ìƒ",description:"ëª¨ë“  ìŠ¤íƒ¯ì´ 40 ì´ìƒìœ¼ë¡œ ì¸ìƒì„ ë§ˆê°",condition:{type:"stat_final_min",stat:"intelligence",value:40},icon:"âš–ï¸"},{id:"underdog",title:"ì—­ê²½ì˜ ìŠ¹ì",description:"ì²´ë ¥ 20 ì´í•˜ì—ì„œ ì‹œì‘í•˜ì—¬ 80ì„¸ ì´ìƒ ìƒì¡´",condition:{type:"age_min",value:80},icon:"ğŸ†"},{id:"wealthy_genius",title:"ë¶€ìœ í•œ ì²œì¬",description:"ì§€ëŠ¥ê³¼ ì¬ì‚°ì´ ëª¨ë‘ 80 ì´ìƒìœ¼ë¡œ ì¸ìƒì„ ë§ˆê°",condition:{type:"stat_final_min",stat:"intelligence",value:80},icon:"ğŸ‘‘"},{id:"weak_end",title:"ì‡ ì•½í•œ ìµœí›„",description:"ì²´ë ¥ 10 ì´í•˜ë¡œ ì¸ìƒì„ ë§ˆê°",condition:{type:"stat_final_max",stat:"strength",value:10},icon:"ğŸ©¼"},{id:"poor",title:"ë¹ˆì†ì˜ ì¸ìƒ",description:"ì¬ì‚° 10 ì´í•˜ë¡œ ì¸ìƒì„ ë§ˆê°",condition:{type:"stat_final_max",stat:"wealth",value:10},icon:"ğŸšï¸"}],Z=60,z=95;function R(t){return t<0||t<=5?"infant":t<=18?"student":t<=59?"adult":"senior"}function tt(t,r){if(r<40)return{...t};let n,e,a,s;return r<50?(n=-1,e=0,a=0,s=0):r<60?(n=-1,e=-1,a=0,s=0):r<70?(n=-2,e=-1,a=-1,s=0):r<80?(n=-2,e=-1,a=-1,s=-1):(n=-3,e=-2,a=-2,s=-1),{strength:A(t.strength+n),charm:A(t.charm+e),intelligence:A(t.intelligence+a),luck:A(t.luck+s),wealth:t.wealth}}function et(t,r,n){if(t<Z)return!1;if(t>=z)return!0;const a=(t-55)*.02*(1-r.strength/200);return n.next()<a}function nt(t,r,n){const e=D(t.prngState),a=R(t.currentAge),s=$(n,t.currentAge,a,t.stats,t.acquiredTags),c=s.length>0?s:n.filter(_=>_.stage===a),l=K(c,e),d=Math.min(Math.max(0,r),l.choices.length-1),i=l.choices[d],u=Q(i,t.stats),g=V(t.stats,u.statChanges),y=tt(g,t.currentAge),v=[...t.acquiredTags,...u.tags],h=t.currentAge+1,S=R(h),o=et(h,y,e),p={age:t.currentAge,event:l,choiceIndex:d,statChanges:u.statChanges,succeeded:u.succeeded,acquiredTags:u.tags};return{newState:{...t,currentAge:h,currentStage:S,stats:y,history:[...t.history,p],acquiredTags:v,isAlive:!o,prngState:e.state()},turnResult:p}}function ot(t,r,n,e,a){const s=[];for(const c of Y)rt(c,r,n,e,a)&&s.push(c.id);return s}function rt(t,r,n,e,a){const{condition:s}=t;switch(t.id){case"balanced":return r.intelligence>=40&&r.strength>=40&&r.charm>=40&&r.luck>=40&&r.wealth>=40;case"underdog":return a===void 0?!1:a.strength<=20&&n>=80;case"wealthy_genius":return r.intelligence>=80&&r.wealth>=80}switch(s.type){case"stat_final_min":return s.stat===void 0||s.value===void 0?!1:r[s.stat]>=s.value;case"stat_final_max":return s.stat===void 0||s.value===void 0?!1:r[s.stat]<=s.value;case"has_tag":return s.tag===void 0?!1:e.includes(s.tag);case"age_min":return s.value===void 0?!1:n>=s.value;case"age_max":return s.value===void 0?!1:n<=s.value;default:return!1}}const I="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",x=I.length,P=6,st=Math.pow(x,P)-1;function at(){return((Date.now()^Math.random()*4294967295)>>>0)%(st+1)}function ut(t){let r=t>>>0;const n=[];for(let e=0;e<P;e++)n.unshift(I[r%x]),r=Math.floor(r/x);return n.join("")}function lt(t){const r=t.toUpperCase().trim();let n=0;for(let e=0;e<r.length;e++){const a=I.indexOf(r[e]);if(a===-1)throw new Error(`stringToSeed: ìœ íš¨í•˜ì§€ ì•Šì€ ë¬¸ì "${r[e]}"`);n=n*x+a}return n>>>0}const M={phase:"title",character:null,currentAge:0,currentStage:"infant",stats:{intelligence:50,strength:50,charm:50,luck:50,wealth:50},history:[],acquiredTags:[],isAlive:!0,seed:0,prngState:0,currentEvent:null,lastTurnResult:null,loadedEvents:[]},dt=L()(F((t,r)=>({...M,startNewGame:(n,e,a,s)=>{const c=s??at(),l=D(c),d=X(l,a);t({phase:"playing",character:{name:n,gender:e,country:a,seed:c,initialStats:{...d}},currentAge:0,currentStage:"infant",stats:d,history:[],acquiredTags:[],isAlive:!0,seed:c,prngState:l.state(),currentEvent:null,lastTurnResult:null})},advanceTurn:n=>{const e=r();if(!e.isAlive||e.phase!=="playing")return;const a=e.loadedEvents.length>0?e.loadedEvents:[];if(a.length===0)return;const s={phase:e.phase,character:e.character,currentAge:e.currentAge,currentStage:e.currentStage,stats:e.stats,history:e.history,acquiredTags:e.acquiredTags,isAlive:e.isAlive,seed:e.seed,prngState:e.prngState},{newState:c,turnResult:l}=nt(s,n,a),d=c.isAlive?"playing":"report";t({phase:d,currentAge:c.currentAge,currentStage:c.currentStage,stats:c.stats,history:c.history,acquiredTags:c.acquiredTags,isAlive:c.isAlive,prngState:c.prngState,lastTurnResult:l,currentEvent:null})},resetGame:()=>{t({...M})},loadFromSeed:(n,e,a,s)=>{r().startNewGame(e,a,s,n)},setEvents:n=>{t({loadedEvents:n})}}),{name:"pixel-life-game-state",partialize:t=>({phase:t.phase,character:t.character,currentAge:t.currentAge,currentStage:t.currentStage,stats:t.stats,history:t.history,acquiredTags:t.acquiredTags,isAlive:t.isAlive,seed:t.seed,prngState:t.prngState})}));export{Y as A,ct as S,lt as a,at as b,D as c,K as d,ot as e,$ as f,X as g,J as h,U as i,ut as s,dt as u};
