function c(e){return new Promise((n,t)=>{e.oncomplete=e.onsuccess=()=>n(e.result),e.onabort=e.onerror=()=>t(e.error)})}function y(e,n){let t;const r=()=>{if(t)return t;const o=indexedDB.open(e);return o.onupgradeneeded=()=>o.result.createObjectStore(n),t=c(o),t.then(u=>{u.onclose=()=>t=void 0},()=>{}),t};return(o,u)=>r().then(f=>u(f.transaction(n,o).objectStore(n)))}let i;function s(){return i||(i=y("keyval-store","keyval")),i}function l(e,n=s()){return n("readonly",t=>c(t.get(e)))}function p(e,n,t=s()){return t("readwrite",r=>(r.put(n,e),c(r.transaction)))}function g(e,n=s()){return n("readwrite",t=>(t.delete(e),c(t.transaction)))}function h(e,n){return e.openCursor().onsuccess=function(){this.result&&(n(this.result),this.result.continue())},c(e.transaction)}function w(e=s()){return e("readonly",n=>{if(n.getAllKeys)return c(n.getAllKeys());const t=[];return h(n,r=>t.push(r.key)).then(()=>t)})}const d="pixel-life:record:";function a(e){return`${d}${e}`}async function K(e){await p(a(e.id),e)}async function R(){const n=(await w()).filter(r=>typeof r=="string"&&r.startsWith(d)),t=[];for(const r of n){const o=await l(r);o&&t.push(o)}return t.sort((r,o)=>o.createdAt-r.createdAt),t}async function A(e){return l(a(e))}async function S(e){await g(a(e))}export{R as a,S as d,A as g,K as s};
