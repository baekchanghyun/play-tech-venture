import{j as e,u as B,a as F,r as d}from"./index-OPFde3V9.js";import{S as L,s as w,u as p,e as M,A as U}from"./game-store-Do9y9pZe.js";import{g as O,s as V}from"./history-db-Bpxs1fj9.js";import{P as N}from"./PixelCard-DXqAhZFG.js";import{S as X}from"./StatPanel-C1_lpaWF.js";function _(o){return`${o}ì„¸`}function z(o,s,n,r){const i=`${w(o)}|${s}|${n}|${r}`;return btoa(encodeURIComponent(i))}async function I(o){await navigator.clipboard.writeText(o)}function J(o){const{character:s,finalAge:n,finalStats:r,achievements:a}=o,i=Object.keys(L).map(h=>`  ${L[h]}: ${r[h]}`).join(`
`),c=a.length>0?`ì—…ì : ${a.join(", ")}`:"ì—…ì : ì—†ìŒ";return["[ PIXEL LIFE ]",`${s.name}ì˜ ì¸ìƒ (${_(n)})`,`ì¶œìƒ: ${s.country.name} | ì„±ë³„: ${s.gender==="male"?"ë‚¨":s.gender==="female"?"ì—¬":"ê¸°íƒ€"}`,"","-- ìµœì¢… ìŠ¤íƒ¯ --",i,"",c,"",`ì‹œë“œ: ${w(s.seed)}`,"ê°™ì€ ì¸ìƒì„ ì‚´ì•„ë³´ì„¸ìš”!"].join(`
`)}function $(o){return o.reduce((s,n)=>s+Math.abs(n.delta),0)}function K({history:o}){const s=o.filter(a=>$(a.statChanges)>=5),r=[...s.length>0?s:[...o].sort((a,i)=>$(i.statChanges)-$(a.statChanges)).slice(0,10)].sort((a,i)=>a.age-i.age);return r.length===0?e.jsx("div",{className:"text-[var(--color-text-dim)] text-center py-4",children:"ì•„ì§ ê¸°ë¡ëœ ì´ë²¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤."}):e.jsxs("div",{className:"relative pl-6",children:[e.jsx("div",{className:"absolute left-2 top-0 bottom-0 w-[2px]",style:{backgroundColor:"var(--color-border)"}}),r.map((a,i)=>e.jsxs("div",{className:"relative mb-4 last:mb-0",children:[e.jsx("div",{className:"absolute -left-4 top-1 w-3 h-3",style:{backgroundColor:"var(--color-accent)",boxShadow:`
                1px 0 0 0 var(--color-accent),
                -1px 0 0 0 var(--color-accent),
                0 1px 0 0 var(--color-accent),
                0 -1px 0 0 var(--color-accent)
              `}}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsxs("span",{className:"text-[var(--color-stat-luck)] text-sm font-bold shrink-0",children:[a.age,"ì„¸"]}),e.jsx("span",{className:"text-[var(--color-text-white)] text-sm",children:a.eventTitle})]}),a.statChanges.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-1 ml-8",children:a.statChanges.map((c,h)=>e.jsxs("span",{className:"text-xs",style:{color:c.delta>0?"#44cc44":"#ff4444"},children:[c.stat==="intelligence"&&"ì§€ëŠ¥",c.stat==="strength"&&"ì²´ë ¥",c.stat==="charm"&&"ë§¤ë ¥",c.stat==="luck"&&"ìš´",c.stat==="wealth"&&"ì¬ì‚°",!["intelligence","strength","charm","luck","wealth"].includes(c.stat)&&c.stat," ",c.delta>0?`+${c.delta}`:c.delta,c.delta>0?" â–²":" â–¼"]},`${a.eventId}-stat-${h}`))})]},`${a.eventId}-${i}`))]})}function Q({id:o,title:s,icon:n,unlocked:r}){return e.jsxs("div",{className:`
        inline-flex flex-col items-center justify-center
        w-20 h-20 p-2
        text-center
        ${r?"opacity-100":"opacity-40"}
      `,style:{backgroundColor:r?"var(--color-bg-secondary)":"var(--color-bg-card)",boxShadow:`
          2px 0 0 0 ${r?"var(--color-accent)":"var(--color-border)"},
          -2px 0 0 0 ${r?"var(--color-accent)":"var(--color-border)"},
          0 2px 0 0 ${r?"var(--color-accent)":"var(--color-border)"},
          0 -2px 0 0 ${r?"var(--color-accent)":"var(--color-border)"}
        `},title:r?s:"???","data-achievement-id":o,children:[e.jsx("span",{className:"text-2xl mb-1",children:r?n:"ğŸ”’"}),e.jsx("span",{className:"text-xs leading-tight",style:{color:r?"var(--color-text-white)":"var(--color-text-dim)"},children:r?s:"???"})]})}function re(){const o=B(),[s]=F(),n=s.get("id"),r=p(t=>t.character),a=p(t=>t.stats),i=p(t=>t.history),c=p(t=>t.currentAge),h=p(t=>t.acquiredTags),R=p(t=>t.seed),[v,k]=d.useState(null),[P,C]=d.useState(n!==null),[T,D]=d.useState(!1),[A,y]=d.useState("idle"),[E,S]=d.useState("idle");d.useEffect(()=>{n!==null&&(C(!0),O(n).then(t=>{t!==void 0&&k(t),C(!1)}))},[n]);const x=n!==null&&v!==null,l=x?v.character:r,u=x?v.finalStats:a,b=x?v.finalAge:c,f=x?v.history:i,m=x?v.character.seed:R,j=x?v.achievements:M(f,u,b,h,l?.initialStats);d.useEffect(()=>{!x&&l!==null&&!T&&(D(!0),V({id:`${m}-${Date.now()}`,character:l,finalAge:b,finalStats:{...u},history:[...f],achievements:j,createdAt:Date.now()}))},[x,l,T,m,b,u,f,j]);const H=f.map(t=>({age:t.age,eventTitle:t.event.title,eventId:t.event.id,statChanges:t.statChanges.map(g=>({stat:g.stat,delta:g.delta}))})),G=d.useCallback(()=>{if(l===null)return;const g=J({character:l,finalAge:b,finalStats:u,achievements:j});I(g).then(()=>{y("copied"),setTimeout(()=>y("idle"),2e3)}).catch(()=>{y("error"),setTimeout(()=>y("idle"),2e3)})},[l,m,b,u,f,j]),q=d.useCallback(()=>{if(l===null)return;const t=z(m,l.name,l.gender,l.country.id),g=`${window.location.origin}${window.location.pathname}#/create?seed=${w(m)}&share=${t}`;I(g).then(()=>{S("copied"),setTimeout(()=>S("idle"),2e3)}).catch(()=>{S("error"),setTimeout(()=>S("idle"),2e3)})},[l,m]);return P?e.jsx("div",{className:"flex items-center justify-center min-h-[400px] text-[var(--color-text-dim)]",children:"ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘..."}):l===null?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] gap-4",children:[e.jsx("p",{className:"text-[var(--color-text-dim)]",children:"í‘œì‹œí•  ì¸ìƒ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤."}),e.jsx("button",{type:"button",className:"px-6 py-2 bg-[var(--color-bg-card)] text-[var(--color-text-primary)] hover:bg-[var(--color-bg-hover)] transition-colors duration-100 border-0 cursor-pointer",style:{boxShadow:`
              2px 0 0 0 var(--color-border),
              -2px 0 0 0 var(--color-border),
              0 2px 0 0 var(--color-border),
              0 -2px 0 0 var(--color-border)
            `},onClick:()=>o("/"),children:"íƒ€ì´í‹€ë¡œ ëŒì•„ê°€ê¸°"})]}):e.jsxs("div",{className:"flex flex-col gap-6 py-4",children:[e.jsxs("div",{className:"text-sm text-[var(--color-text-dim)]",children:[e.jsx("span",{className:"text-[var(--color-accent)]",children:">"})," ì¸ìƒ ë¦¬í¬íŠ¸"]}),e.jsxs("div",{className:"text-center py-2",children:[e.jsxs("h2",{className:"text-2xl text-[var(--color-text-white)] mb-1",children:[l.name,"ì˜ ì¸ìƒ"]}),e.jsxs("p",{className:"text-lg text-[var(--color-stat-luck)]",children:["í–¥ë…„ ",b,"ì„¸"]}),e.jsxs("p",{className:"text-xs text-[var(--color-text-dim)] mt-1",children:[l.country.name," ì¶œìƒ | ì‹œë“œ: ",w(m)]})]}),e.jsx(N,{title:"ìµœì¢… ìŠ¤íƒ¯",children:e.jsx(X,{stats:u})}),e.jsx(N,{title:"íƒ€ì„ë¼ì¸",children:e.jsx(K,{history:H})}),e.jsx(N,{title:"ì—…ì ",children:e.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:U.map(t=>e.jsx(Q,{id:t.id,title:t.title,icon:t.icon,unlocked:j.includes(t.id)},t.id))})}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("button",{type:"button",className:"w-full px-4 py-3 text-center bg-[var(--color-bg-card)] text-[var(--color-text-primary)] hover:bg-[var(--color-bg-hover)] hover:text-[var(--color-text-white)] transition-colors duration-100 border-0 cursor-pointer",style:{boxShadow:`
              2px 0 0 0 var(--color-border),
              -2px 0 0 0 var(--color-border),
              0 2px 0 0 var(--color-border),
              0 -2px 0 0 var(--color-border)
            `},onClick:G,children:A==="copied"?"ë³µì‚¬ ì™„ë£Œ!":A==="error"?"ë³µì‚¬ ì‹¤íŒ¨":"í…ìŠ¤íŠ¸ë¡œ ë³µì‚¬"}),e.jsx("button",{type:"button",className:"w-full px-4 py-3 text-center bg-[var(--color-bg-card)] text-[var(--color-text-primary)] hover:bg-[var(--color-bg-hover)] hover:text-[var(--color-text-white)] transition-colors duration-100 border-0 cursor-pointer",style:{boxShadow:`
              2px 0 0 0 var(--color-border),
              -2px 0 0 0 var(--color-border),
              0 2px 0 0 var(--color-border),
              0 -2px 0 0 var(--color-border)
            `},onClick:q,children:E==="copied"?"URL ë³µì‚¬ ì™„ë£Œ!":E==="error"?"ë³µì‚¬ ì‹¤íŒ¨":"ì‹œë“œ ê³µìœ "}),e.jsxs("button",{type:"button",className:"w-full px-6 py-4 text-center text-lg bg-[var(--color-bg-card)] text-[var(--color-accent)] hover:bg-[var(--color-bg-hover)] hover:text-[var(--color-text-white)] transition-colors duration-100 border-0 cursor-pointer",style:{boxShadow:`
              2px 0 0 0 var(--color-accent-dim),
              -2px 0 0 0 var(--color-accent-dim),
              0 2px 0 0 var(--color-accent-dim),
              0 -2px 0 0 var(--color-accent-dim)
            `},onClick:()=>{p.getState().resetGame(),o("/create")},children:[e.jsx("span",{className:"mr-2",children:"â–¶"}),"ìƒˆ ì¸ìƒ ì‹œì‘"]})]})]})}export{re as default};
